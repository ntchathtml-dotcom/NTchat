<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>チャットアプリ</title>
<script src="/socket.io/socket.io.js"></script>
<style>
body { font-family: sans-serif; }
#messages { list-style: none; padding: 0; }
#messages li { padding: 5px; border-bottom: 1px solid #ccc; }
#login { margin: 20px; }
#chat { display: none; }
</style>
</head>
<body>
<div id="login">
<h3>チャットに参加する</h3>
<input id="nameInput" placeholder="名前を入力してください" />
<button id="joinBtn">参加</button>
</div>

<div id="chat">
<ul id="messages"></ul>
<form id="form">
<input id="input" autocomplete="off" placeholder="メッセージを入力..." />
<button>送信</button>
</form>
</div>

<script>
const socket = io();
let username = "";

const loginDiv = document.getElementById("login");
const chatDiv = document.getElementById("chat");
const joinBtn = document.getElementById("joinBtn");
const nameInput = document.getElementById("nameInput");

const form = document.getElementById("form");
const input = document.getElementById("input");
const messages = document.getElementById("messages");

joinBtn.addEventListener("click", () => {
  const name = nameInput.value.trim();
  if (name) {
    username = name;
    loginDiv.style.display = "none";
    chatDiv.style.display = "block";
  }
});

form.addEventListener("submit", (e) => {
  e.preventDefault();
  if (!input.value.trim()) return;

  const now = new Date();
  const time = now.getHours().toString().padStart(2, "0") + ":" +
               now.getMinutes().toString().padStart(2, "0");

  const message = { user: username, text: input.value.trim(), time: time };
  socket.emit("chat message", message);
  input.value = "";
});

socket.on("chat message", (msg) => {
  const li = document.createElement("li");
  li.textContent = `${msg.user} : ${msg.text} (${msg.time})`;
  messages.appendChild(li);
  window.scrollTo(0, document.body.scrollHeight);

  if (msg.user !== username) {
    const audio = new Audio("notify.mp3");
    audio.play();
  }
});
</script>
</body>
</html>
